!function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=3)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.geocoder=null}return o(e,[{key:"getGeocoder",value:function(){return this.geocoder||(this.geocoder=new google.maps.Geocoder),this.geocoder}},{key:"geocode",value:function(e,n){var t=this;return new Promise(function(o,i){var a,r,s;t.getGeocoder().geocode((s=n,(r=e)in(a={})?Object.defineProperty(a,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[r]=s,a),function(e,n){n==google.maps.GeocoderStatus.OK?o(e):i("status "+n)})})}},{key:"geocodeAddress",value:function(e){return this.geocode("address",e)}},{key:"geocodePlaceId",value:function(e){return this.geocode("placeId",e)}}]),e}();n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var i=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.url="http://en.wikipedia.org/w/api.php"}return o(e,[{key:"geosearchLocation",value:function(e,n){var t=this;return new Promise(function(o,i){$.ajax({url:t.url,data:{format:"json",action:"query",list:"geosearch",gsradius:1e4,gscoord:e+"|"+n},dataType:"jsonp"}).done(function(e,n,t){200==t.status?o(e):i("status "+t.status)}).fail(function(e){return i("status "+e.status)})})}},{key:"searchPageIds",value:function(e){var n=this;return new Promise(function(t,o){$.ajax({url:n.url,data:{format:"json",action:"query",prop:"extracts",exintro:"",pageids:e.join("|")},dataType:"jsonp"}).done(function(e,n,i){200==i.status?t(e):o("status "+i.status)}).fail(function(e){return o("status "+e.status)})})}}]),e}();n.default=i},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.default=function e(n,t,o){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.label=n,this.lat=t,this.lng=o}},function(e,n,t){"use strict";var o=a(t(4)),i=a(t(13));function a(e){return e&&e.__esModule?e:{default:e}}t(14);var r={googleMapsApiKey:"AIzaSyCZkjL847cY6nQvRo2zhSdVYlMnC59JijA",modelResolveDelayAsMillis:1e3,localStorageKey:"neighborhood-map",mapCenter:{lat:48.856614,lng:2.3522219000000177},mapZoom:11},s=new Promise(function(e,n){window.onGoogleMapsSuccess=function(){e()},window.onGoogleMapsFailure=function(){n()}});$(function(){window.ko.applyBindings(new o.default(window.ko,r,new i.default(r),s))})},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=r(t(5)),i=r(t(7)),a=r(t(11));function r(e){return e&&e.__esModule?e:{default:e}}n.default=function e(n,t,r,s){var l=this;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.model=r,this.listView=new o.default(n),this.adminView=new a.default(n,t),this.shouldShowMenu=n.observable(!$(".menu-btn").is(":visible")),this.onMenuClick=function(){l.shouldShowMenu(!l.shouldShowMenu())},this.model.init(function(e){l.listView.render(e)}),this.listView.init(function(e){l.mapView&&l.mapView.render(e)},function(e){l.mapView&&l.mapView.onLocationClick(e)}),this.adminView.init(function(e){l.model.addLocation(e)},function(e){l.model.removeLocation(e)}),s.then(function(){l.mapView=new i.default(n,t),l.mapView.init(),n.applyBindings(l.mapView,$(".mapview")[0]),l.mapView.render(l.listView.filteredLocations())}).catch(function(){window.alert("Google Maps API load failure")})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(6);var i=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.ko=n}return o(e,[{key:"init",value:function(e,n){var t=this;this.locations=this.ko.observableArray([]),this.locationFilter=this.ko.observable(""),this.onLocationClick=n,this.filteredLocations=this.ko.computed(function(){if(!t.locationFilter())return t.locations();try{var e=new RegExp(t.locationFilter());return t.ko.utils.arrayFilter(t.locations(),function(n){return n.label.search(e)>=0})}catch(e){return t.locations()}}),this.filteredLocations.subscribe(e)}},{key:"render",value:function(e){var n=e.sort(function(e,n){return e.label.localeCompare(n.label)});this.locations(n),this.locations.valueHasMutated()}}]),e}();n.default=i},function(e,n){},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(8);var i=r(t(0)),a=r(t(9));function r(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(n,t){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.ko=n,this.mapsApi=new i.default(t),this.config=t,this.locations=new Map,this.map=null,this.bounds=null,this.currentLocation=null}return o(e,[{key:"init",value:function(){}},{key:"render",value:function(e){var n=this;this.map=new google.maps.Map($("#map")[0],{center:this.config.mapCenter,zoom:this.config.mapZoom}),this.bounds=new google.maps.LatLngBounds,this.locations.clear();var t=!0,o=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var l=r.value;this.locations.set(l.label,new a.default(this.ko,l))}}catch(e){o=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw i}}Array.from(this.locations.values()).forEach(function(e){var t=new google.maps.Marker({map:n.map,position:{lat:e.lat,lng:e.lng}});e.marker=t,n.bounds.extend(t.position),e.marker.addListener("click",function(){n.closeCurrentLocation(e)||e.openInfowindow(n)})}),this.map.fitBounds(this.bounds),google.maps.event.addDomListener(window,"resize",function(){n.map.fitBounds(n.bounds)})}},{key:"onLocationClick",value:function(e){var n=e.label,t=this.locations.get(n);this.closeCurrentLocation(t)||t.marker&&t.openInfowindow(this)}},{key:"closeCurrentLocation",value:function(e){var n=e===this.currentLocation;return this.currentLocation&&this.currentLocation.closeInfowindow(this),n}}]),e}();n.default=s},function(e,n){},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(10);var i,a=t(1),r=(i=a)&&i.__esModule?i:{default:i};var s=function(){function e(n,t){var o=t.label,i=t.lat,a=t.lng;!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.ko=n,this.label=o,this.lat=i,this.lng=a,this.marker=null,this.infowindow=null,this.timeoutId=0,this.panorama=null,this.wikiApi=new r.default,this.isInfoWindowLoaded=!1,this.streetViewContent=null,this.wikimediaContent=null,this.domReady=null}return o(e,[{key:"openInfowindow",value:function(e){var n=this;this.streetViewContent=this.ko.observable(""),this.wikimediaContent=this.ko.observable("");var t=new google.maps.InfoWindow;t.addListener("closeclick",function(){n.closeInfowindow(e)}),t.setContent('<div class="locationview" data-bind="template: { name: \'locationview-template\' }">\n                           </div>');var o=new Promise(function(e){google.maps.event.addListener(t,"domready",function(){n.isInfoWindowLoaded||(n.ko.applyBindings(n,$(".locationview")[0]),n.isInfoWindowLoaded=!0,e())})});this.openStreetView(o),this.openNearbyPlaces(o),e.currentLocation=this,t.open(e.map,this.marker),this.infowindow=t,this.marker.setAnimation(google.maps.Animation.BOUNCE),this.timeoutId=window.setTimeout(function(){return n.marker.setAnimation(null)},750)}},{key:"closeInfowindow",value:function(e){this.panorama=null,e.currentLocation=null,window.clearTimeout(this.timeoutId),this.timeoutId=0,this.marker.setAnimation(null),this.infowindow.close(),this.infowindow=null,this.isInfoWindowLoaded=!1,this.streetViewContent=null,this.wikimediaContent=null,e.map.fitBounds(e.bounds)}},{key:"openStreetView",value:function(e){var n=this;(new google.maps.StreetViewService).getPanoramaByLocation(this.marker.position,50,function(t,o){if(o==google.maps.StreetViewStatus.OK){var i=t.location.latLng,a={position:i,pov:{heading:google.maps.geometry.spherical.computeHeading(i,n.marker.position),pitch:0}};e.then(function(){n.isInfoWindowLoaded&&(n.panorama=new google.maps.StreetViewPanorama($("#street-view")[0],a))})}else e.then(function(){n.isInfoWindowLoaded&&n.streetViewContent("StreetView error (status "+o+")")})})}},{key:"openNearbyPlaces",value:function(e){var n=this;this.wikiApi.geosearchLocation(this.marker.position.lat(),this.marker.position.lng()).then(function(e){var t=e.query.geosearch.map(function(e){return e.pageid});return n.wikiApi.searchPageIds(t)}).then(function(t){var o='<h2>Nearby Wikis:</h2>\n                         <span><a href="https://www.wikimedia.org/"><small>Powered by Wikimedia</small></a><span>\n                         <ul>';$.each(t.query.pages,function(e,n){o+="<li>\n               <h3>"+n.title+"</h3>\n               <p>"+n.extract+"</p>\n             </li>"}),o+="</ul>",e.then(function(){n.isInfoWindowLoaded&&n.wikimediaContent(o)})}).catch(function(t){e.then(function(){n.isInfoWindowLoaded&&n.wikimediaContent("Wikimedia errror ("+t+")")})})}}]),e}();n.default=s},function(e,n){},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();t(12);var i=s(t(0)),a=s(t(1)),r=s(t(2));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(n,t){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.ko=n,this.config=t,this.mapsApi=new i.default(t),this.wikiApi=new a.default}return o(e,[{key:"init",value:function(e,n){var t=this;this.contentDisplayed=this.ko.observable(!1),this.addressToGeocode=this.ko.observable(""),this.placeIdToGeocode=this.ko.observable(""),this.geocodeAddress=function(){if(t.addressToGeocode()){var e=t.addressToGeocode();t.mapsApi.geocodeAddress(t.addressToGeocode()).then(function(n){if(n&&n[0]){console.log(n);var o=n[0].geometry.location,i=JSON.stringify({lat:o.lat(),lng:o.lng()});t.label(e),t.latLng(i),t.latLngToGeosearch(i)}else console.log("invalid response content")}).catch(function(e){return console.log(e)}),t.addressToGeocode("")}},this.geocodePlaceId=function(){t.placeIdToGeocode()&&(t.mapsApi.geocodePlaceId(t.placeIdToGeocode()).then(function(e){return console.log(e)}).catch(function(e){return console.log(e)}),t.placeIdToGeocode(""))},this.latLngToGeosearch=this.ko.observable(""),this.goesearchLatlng=function(){if(t.latLngToGeosearch()){var e=JSON.parse(t.latLngToGeosearch());t.wikiApi.geosearchLocation(e.lat,e.lng).then(function(e){console.log(e),console.log("pageId "+e.query.geosearch[0].pageid);var n=e.query.geosearch.map(function(e){return e.pageid});t.pageIdsToQuery(JSON.stringify(n))}).catch(function(e){return console.log(e)}),t.latLngToGeosearch("")}},this.pageIdsToQuery=this.ko.observable(""),this.queryPageIds=function(){if(t.pageIdsToQuery()){var e=JSON.parse(t.pageIdsToQuery());t.wikiApi.searchPageIds(e).then(function(e){console.log(e)}).catch(function(e){return console.log(e)}),t.pageIdsToQuery("")}},this.label=this.ko.observable(""),this.latLng=this.ko.observable(""),this.addLocation=function(){if(t.label()&&t.latLng()){var n=JSON.parse(t.latLng());e(new r.default(t.label(),n.lat,n.lng)),t.label(""),t.latLng("")}},this.removeLocation=function(){t.label()&&(n(t.label()),t.label(""))}}}]),e}();n.default=l},function(e,n){},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o,i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),a=t(2),r=(o=a)&&o.__esModule?o:{default:o};var s=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=n,this.onLocations=null}return i(e,[{key:"init",value:function(e){var n=this;this.onLocations=e,localStorage[this.config.localStorageKey]||this.initStorage();var t=JSON.parse(localStorage[this.config.localStorageKey]);new Promise(function(e){window.setTimeout(function(){e(t)},n.config.modelResolveDelayAsMillis)}).then(function(e){n.onLocations(e)})}},{key:"initStorage",value:function(){var e=[new r.default("Paris",48.856614,2.3522219000000177),new r.default("Strasbourg",48.5734053,7.752111300000024),new r.default("Marseille",43.296482,5.369779999999992),new r.default("Lyon",45.764043,4.835658999999964),new r.default("Bordeaux",44.837789,-.5791799999999512),new r.default("Brest",48.390394,-4.4860760000000255)];localStorage[this.config.localStorageKey]=JSON.stringify(e)}},{key:"addLocation",value:function(e){var n=JSON.parse(localStorage[this.config.localStorageKey]);n.filter(function(n){return n.label==e.label}).length?console.log("addLocation label "+e.label+" already exists"):(n.push(e),localStorage[this.config.localStorageKey]=JSON.stringify(n),this.onLocations(n))}},{key:"removeLocation",value:function(e){var n=JSON.parse(localStorage[this.config.localStorageKey]);n=n.filter(function(n){return n.label!=e}),localStorage[this.config.localStorageKey]=JSON.stringify(n),this.onLocations(n)}}]),e}();n.default=s},function(e,n){}]);